> Демонстрационный проект:
> 
> [https://asciinema.org/a/LO5LY8HUHaUjH6zHoZo61Qkw1](https://asciinema.org/a/LO5LY8HUHaUjH6zHoZo61Qkw1)

## Прежде, чем приступить к выполнению проекта

Данный проект ориентирован на прокачку Test-driven Development (TDD) — разработку через тестирование. Каждый шаг проекта описывает что необходимо реализовать, а способ реализации и кейсы тестирования выбирает сам студент. Для реализации самой утилиты достаточно обладать опытом написания кода для работы с сетевыми запросами и работы DOM на уровне jQuery или стандартного API.

Если у вас отсутствует опыт написания production-кода на JavaScript и вы не справляетесь с реализацией утилиты, то обратитесь к наставнику, чтобы получить готовую реализацию. Под неё останется только настроить окружение и написать тесты.

Чтобы оценить свой уровень подготовки к проекту, начните его выполнять и задавайте вопросы в группе по мере возникновения. Если кажущаяся сложность не снизится в процессе решения, вы в любой момент сможете обратиться за готовой реализацией.

## Скачивание страницы

Реализуйте утилиту командной строки _page-loader_, которая, скачивает страницу из сети и кладёт в указанную директорию (по умолчанию в директорию запуска программы). Вывод программы должен содержать полный путь к загруженному файлу.

На данном этапе не производятся манипуляции с содержимым, только сохранение.

```
    # по умолчанию output это process.cwd()
    npx babel-node page-loader --output /var/tmp https://ru.hexlet.io/courses
    /var/tmp/ru-hexlet-io-courses.html # путь к загруженному файлу
    
    open /var/tmp/ru-hexlet-io-courses.html
```   

Имя файла должно формироваться следующим образом:

1.  Берётся адрес страницы без [протокола](https://nodejs.org/dist/latest-v15.x/docs/api/url.html#url_url_protocol).
2.  Все символы, кроме букв и цифр заменяются на дефис _\-_.
3.  В конце ставится _.html_.

Пример:

```
    https://ru.hexlet.io/courses
    ru-hexlet-io-courses.html
```

## Библиотека

Любая программа, одновременно является и библиотекой. Другими словами, библиотеку которую мы разрабатываем, можно установить как зависимость в любом другом NPM-пакете. Пример того, как другие пакеты могли бы использовать наш _pageLoader_:

    import pageLoader from '@hexlet/code';
    
    await pageLoader('https://ru.hexlet.io/courses', '/var/tmp');
    // { filepath: '/var/tmp/ru-hexlet-io-courses.html' } - объект с путём до загруженного файла
    

Библиотека возвращает объект с единственным свойством `filepath`, который содержит полный путь до загруженного html-файла.

## Консольная утилита

Для работы с нашей утилитой через терминал надо сделать так, чтобы cli-утилита могла принимать через командную строку опцию `-o` (`--output`), отвечающую за путь для загрузки файлов. В этом проекте для удобной работы со входными данными из терминала используйте утилиту [Commander.js](https://github.com/tj/commander.js/). Вам понадобятся методы `option`, `arguments`, `action`, `description`, `version`.

## Требования к проекту

*   Путь к исполняемому файлу в секции `bin` в _package.json_ должен ссылаться на существующий скрипт (не обработанный бабелем).

Для того, чтобы тесты Хекслета могли протестировать тесты студента, необходимо добавить в проект Babel:

*   Установите [babel](https://babeljs.io/docs/en/usage#overview), [babel/node](https://www.npmjs.com/package/@babel/node) и плагин [babel-jest](https://www.npmjs.com/package/babel-jest) как dev-зависимости.
*   Создайте минимальный конфиг для @babel/preset-env [по образу](https://jestjs.io/docs/getting-started#using-babel).
*   Самостоятельно собирать проект через Babel не понадобится.

## Ссылки

*   [axios](https://github.com/mzabriskie/axios) - библиотека для выполнения http-запросов.
*   [nock](https://github.com/node-nock/nock) - библиотека для мокинга http-запросов.
*   [commander.js](https://github.com/tj/commander.js/) - библиотека для работы с командной строкой.
*   [nodejs-package](https://github.com/hexlet-boilerplates/nodejs-package) — пакет, в котором можно подсматривать настройку окружения
*   [Test Async Code](https://facebook.github.io/jest/docs/asynchronous.html#content) - правила тестирования асинхронного кода в jest.
*   [Плагин babel-jest](https://jestjs.io/ru/docs/getting-started#%D1%81-%D0%B8%D1%81%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5%D0%BC-babel) - использование jest с babel
*   [Скрипты, модули и библиотеки](https://ru.hexlet.io/blog/posts/skripty-moduli-i-biblioteki)
*   [Статья — Как пользоваться CLI для автоматизации рутинных процессов](https://ru.hexlet.io/blog/posts/cli-avtomatizatsiya)

## Задачи

1.  Клонируйте созданный репозиторий проекта локально и инициализируйте ваш npm-пакет внутри корневой директории проекта, используя команду _npm init_. При инициализации задайте имя пакета - `@hexlet/code`.
2.  Оформите пакет — настройте линтер, подключите Jest, подготовьте структуру каталогов.
3.  Установите в проект _babel_ и плагины как dev-зависимости.
4.  Реализуйте загрузку указанной страницы.
5.  Напишите тесты (лучше до кода!).
6.  Создайте исполняемый файл и сделайте так, чтобы утилита через него запускалась, принимала путь для сохранения файла и url для скачивания. Для запуска исполняемого файла используйте _babel-node_, как в примере выше.
7.  Добавьте в ридми аскинему с примером работы пакета.

## Подсказки

*   Для работы с файлами, используйте [https://nodejs.org/api/fs.html#fs\_fs\_promises\_api](https://nodejs.org/api/fs.html#fs_fs_promises_api)
*   Тесты должны быть изолированы друг от друга. Для этого каждая загрузка должна выполняться в своей временной директории: `await fs.mkdtemp(path.join(os.tmpdir(), 'page-loader-'));` (в хуке `beforeEach()`)
*   Для общего кода в тестах (особенно с побочными эффектами) используются хуки `beforeAll()` и `beforeEach()`
*   Тестировать работу через cli не нужно
